{% extends 'base_interna.html' %}

{% block estilos %}
  <link rel="stylesheet" href="/static/assets/css/interna.css">
  <style>
    /* Card container sin borde, sombra suave y borde redondeado */
    .card-subscription {
      border: none;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: pointer;
      background-color: #fff;
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    .card-subscription:hover {
      transform: translateY(-8px);
      box-shadow: 0 16px 40px rgba(0,0,0,0.15);
    }

    /* Imagen superior con bordes redondeados solo arriba */
    .card-img-top {
      border-top-left-radius: 12px;
      border-top-right-radius: 12px;
      height: 180px;
      object-fit: cover;
      width: 100%;
      user-select: none;
      pointer-events: none;
    }

    /* Cuerpo de la tarjeta con flex-grow para que el botón se mantenga abajo */
    .card-body {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      padding: 1.5rem;
      gap: 1rem;
    }

    /* Título centrado, destacado */
    .card-title {
      font-weight: 700;
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      text-align: center;
      user-select: none;
      color: var(--bs-dark); /* Usar variable Bootstrap o define #222 */
    }

    /* Texto de descripción centrado */
    .card-text {
      flex-grow: 0;
      font-size: 1rem;
      color: #555;
      text-align: center;
      line-height: 1.4;
    }

    /* Lista de características */
    .list-group-item {
      border: none;
      padding-left: 0;
      padding-right: 0;
      font-weight: 600;
      color: #444;
      border-left: 4px solid transparent;
      transition: border-color 0.3s ease;
      user-select: none;
    }
    /* Bordes de la lista según tipo de suscripción */
    .card-subscription.premium .list-group-item {
      border-left-color: #28a745;
    }
    .card-subscription.basic .list-group-item {
      border-left-color: #0d6efd;
    }

    /* Botones principales */
    .btn-subscribe {
      width: 100%;
      padding: 12px 0;
      font-weight: 700;
      font-size: 1.1rem;
      border-radius: 8px;
      border: none;
      color: #fff;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    .btn-subscribe.subscription-premium {
      background-color: #28a745;
    }
    .btn-subscribe.subscription-premium:hover {
      background-color: #218838;
      text-decoration: none;
      color: #e9f7ef;
    }
    .btn-subscribe.subscription-basic {
      background-color: #0d6efd;
    }
    .btn-subscribe.subscription-basic:hover {
      background-color: #0b5ed7;
      text-decoration: none;
      color: #dbeafe;
    }

    /* Botón anular */
    .btn-secondary {
      width: 100%;
      font-weight: 700;
      border-radius: 8px;
      padding: 12px 0;
      border: none;
      background-color: #6c757d;
      color: white;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    .btn-secondary:hover {
      background-color: #5a6268;
      color: white;
    }

    /* Texto días restantes */
    .dias-restantes {
      font-size: 0.9rem;
      font-style: italic;
      color: #6c757d;
      text-align: center;
      margin-bottom: 1rem;
      user-select: none;
    }

    /* Mensaje de suscripción activa */
    .text-success {
      font-weight: 700;
      font-size: 1.1rem;
      user-select: none;
    }

    /* Contenedor para que las tarjetas tengan igual altura */
    .col-md-5.col-lg-4 {
      display: flex;
      flex-direction: column;
    }

  </style>
{% endblock %}

{% block contenido %}
<div class="container pt-5" style="margin-top: 50px;">
  <div class="row justify-content-center gy-4">
    <div class="col-md-5 col-lg-4 mb-4">
      <div class="card card-subscription premium shadow-sm">
        <img src="https://img.freepik.com/vector-gratis/etiqueta-brillosa-dorada-lujo_1017-8542.jpg?semt=ais_hybrid&w=740" 
             class="card-img-top" alt="Suscripción Premium Canchas Deportivas">
        <div class="card-body d-flex flex-column">
          <h4 class="card-title">Suscripción Premium</h4>
          <p class="card-text">
            Accede a todas las funcionalidades avanzadas del sistema con soporte prioritario y la posibilidad de registrar hasta <strong>3 canchas deportivas</strong>.
          </p>
          <ul class="list-group list-group-flush mb-4">
            <li class="list-group-item">Acceso ilimitado a todas las funcionalidades</li>
            <li class="list-group-item">Actualizaciones automáticas</li>
            <li class="list-group-item">Soporte 24/7</li>
            <li class="list-group-item">Registrar hasta 3 canchas deportivas</li>
          </ul>
          {% if suscripcion_paga %}
          <p class="text-success">¡Ya tienes una suscripción Premium activa!</p>
          <p class="dias-restantes">Días restantes: {{ dias_restantes }}</p>
          <button class="btn btn-secondary" onclick="anular_suscripcion({{ idSuscripcion }})">Anular Suscripción</button>
          {% else %}
          <a href="/ir_a_registrar_suscripcion_paga" class="btn btn-subscribe subscription-premium mt-auto">Seleccionar Premium</a>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="col-md-5 col-lg-4 mb-4">
      <div class="card card-subscription basic shadow-sm">
        <img src="https://gamingcontinues.com/wp-content/uploads/2024/04/Banner-Suscripcion-Basica.jpg" 
             class="card-img-top" alt="Suscripción Básica Canchas Deportivas">
        <div class="card-body d-flex flex-column">
          <h4 class="card-title">Suscripción Básica</h4>
          <p class="card-text">
            Una opción económica para acceder a funciones esenciales con soporte por correo y la posibilidad de registrar <strong>1 cancha deportiva</strong>.
          </p>
          <ul class="list-group list-group-flush mb-4">
            <li class="list-group-item">Acceso limitado a funcionalidades básicas</li>
            <li class="list-group-item">Actualizaciones básicas</li>
            <li class="list-group-item">Soporte por correo electrónico</li>
            <li class="list-group-item">Registrar 1 cancha deportiva</li>
          </ul>
          {% if suscripcion_paga %}
          <p class="text-success">¡Ya tienes una suscripción Premium activa!</p>
          {% else %}
          {% if suscripcion_gratuita %}
          <p class="text-success">¡Ya tienes una suscripción Básica activa!</p>
          <p class="dias-restantes">Días restantes: {{ dias_restantes }}</p>
          <button class="btn btn-secondary" onclick="anular_suscripcion({{ idSuscripcion }})">Anular Suscripción</button>
          {% else %}
          <a href="/ir_a_registrar_suscripcion_gratuita" class="btn btn-subscribe subscription-basic mt-auto">Seleccionar Básica</a>
          {% endif %}
          {% endif %}
        </div>
      </div>
    </div>

  </div>
</div>
{% endblock %}
{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
  function anular_suscripcion(id) {
    Swal.fire({
      title: '¿Estás seguro?',
      text: 'Esta acción anulará tu suscripción actual.',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonText: 'Sí, anular',
      cancelButtonText: 'Cancelar',
      confirmButtonColor: '#d33',
      cancelButtonColor: '#3085d6',
    }).then((result) => {
      if (result.isConfirmed) {
        fetch('/anular_suscripcion', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ idSuscripcion: id })
        })
        .then(res => {
          if (!res.ok) throw new Error("Error al anular la suscripción");
          return res.json();
        })
        .then(data => {
          Swal.fire({
            title: 'Anulado',
            text: data.message || 'Suscripción anulada correctamente.',
            icon: 'success',
            confirmButtonText: 'OK'
          }).then(() => {
            location.reload();
          });
        })
        .catch(err => {
          Swal.fire({
            title: 'Error',
            text: err.message,
            icon: 'error'
          });
        });
      }
    });
  }
</script>
{% endblock %}
